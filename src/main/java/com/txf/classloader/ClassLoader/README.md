## 初见ClassLoader

### 编写一个类
```
public class _01_FirstClass{

  public String first() {
    return "first";
  }
}
```

### 编译这个类
```
javac _01_FirstClass
```

### 查看编译结果
```
╰─ xxd FirstClass.class                                                                                                                                                           ─╯
00000000: cafe babe 0000 0034 0011 0a00 0400 0d08  .......4........
00000010: 000e 0700 0f07 0010 0100 063c 696e 6974  ...........<init
00000020: 3e01 0003 2829 5601 0004 436f 6465 0100  >...()V...Code..
00000030: 0f4c 696e 654e 756d 6265 7254 6162 6c65  .LineNumberTable
00000040: 0100 0546 6972 7374 0100 1428 294c 6a61  ...First...()Lja
00000050: 7661 2f6c 616e 672f 5374 7269 6e67 3b01  va/lang/String;.
00000060: 000a 536f 7572 6365 4669 6c65 0100 0f46  ..SourceFile...F
00000070: 6972 7374 436c 6173 732e 6a61 7661 0c00  irstClass.java..
00000080: 0500 0601 0005 6669 7273 7401 002a 636f  ......first..*co
00000090: 6d2f 7478 662f 636c 6173 736c 6f61 6465  m/txf/classloade
000000a0: 722f 436c 6173 734c 6f61 6465 722f 4669  r/ClassLoader/Fi
000000b0: 7273 7443 6c61 7373 0100 106a 6176 612f  rstClass...java/
000000c0: 6c61 6e67 2f4f 626a 6563 7400 2100 0300  lang/Object.!...
000000d0: 0400 0000 0000 0200 0100 0500 0600 0100  ................
000000e0: 0700 0000 1d00 0100 0100 0000 052a b700  .............*..
000000f0: 01b1 0000 0001 0008 0000 0006 0001 0000  ................
00000100: 0003 0001 0009 000a 0001 0007 0000 001b  ................
00000110: 0001 0001 0000 0003 1202 b000 0000 0100  ................
00000120: 0800 0000 0600 0100 0000 0500 0100 0b00  ................
00000130: 0000 0200 0c                             .....
```
或
```
╰─ hexdump -C FirstClass.class                                                                                                                                                    ─╯
00000000  ca fe ba be 00 00 00 34  00 11 0a 00 04 00 0d 08  |.......4........|
00000010  00 0e 07 00 0f 07 00 10  01 00 06 3c 69 6e 69 74  |...........<init|
00000020  3e 01 00 03 28 29 56 01  00 04 43 6f 64 65 01 00  |>...()V...Code..|
00000030  0f 4c 69 6e 65 4e 75 6d  62 65 72 54 61 62 6c 65  |.LineNumberTable|
00000040  01 00 05 46 69 72 73 74  01 00 14 28 29 4c 6a 61  |...First...()Lja|
00000050  76 61 2f 6c 61 6e 67 2f  53 74 72 69 6e 67 3b 01  |va/lang/String;.|
00000060  00 0a 53 6f 75 72 63 65  46 69 6c 65 01 00 0f 46  |..SourceFile...F|
00000070  69 72 73 74 43 6c 61 73  73 2e 6a 61 76 61 0c 00  |irstClass.java..|
00000080  05 00 06 01 00 05 66 69  72 73 74 01 00 2a 63 6f  |......first..*co|
00000090  6d 2f 74 78 66 2f 63 6c  61 73 73 6c 6f 61 64 65  |m/txf/classloade|
000000a0  72 2f 43 6c 61 73 73 4c  6f 61 64 65 72 2f 46 69  |r/ClassLoader/Fi|
000000b0  72 73 74 43 6c 61 73 73  01 00 10 6a 61 76 61 2f  |rstClass...java/|
000000c0  6c 61 6e 67 2f 4f 62 6a  65 63 74 00 21 00 03 00  |lang/Object.!...|
000000d0  04 00 00 00 00 00 02 00  01 00 05 00 06 00 01 00  |................|
000000e0  07 00 00 00 1d 00 01 00  01 00 00 00 05 2a b7 00  |.............*..|
000000f0  01 b1 00 00 00 01 00 08  00 00 00 06 00 01 00 00  |................|
00000100  00 03 00 01 00 09 00 0a  00 01 00 07 00 00 00 1b  |................|
00000110  00 01 00 01 00 00 00 03  12 02 b0 00 00 00 01 00  |................|
00000120  08 00 00 00 06 00 01 00  00 00 05 00 01 00 0b 00  |................|
00000130  00 00 02 00 0c                                    |.....|
00000135
```

### 调用类下的方法（隐式类加载）
```
public class _02_ClassLoader{
  public static void main(String[] args) {
    _01_FirstClass a01FirstClass = new _01_FirstClass();
    System.out.println(a01FirstClass.First());
  }
}


```
成功执行输出 ·first·

### 把class转成字节数组

```
/**
 * class转byte数组
 */
public class _03_ClassToByte {
  
  public static void main(String[] args) throws Exception {
    byte[] b = inputStreamToBytes(new FileInputStream("/Users/txf/Ideaproject/JavaLearning/src/main/java/com/txf/classloader/ClassLoader/_01_FirstClass.class"));
    List<String> list = new ArrayList();
    for(int i = 0; i < b.length; ++i) {
      list.add(b[i] + "");
    }
    System.out.print(String.join(", ", list));
  }

  public static byte[] inputStreamToBytes(InputStream is) throws Exception {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    byte[] buff = new byte[1024];
    int len;
    while((len = is.read(buff)) != -1) {
      baos.write(buff, 0, len);
    }
    baos.flush();
    is.close();
    return baos.toByteArray();
  }
}
```
result：
```
-54, -2, -70, -66, 0, 0, 0, 52, 0, 17, 10, 0, 4, 0, 13, 8, 0, 14, 7, 0, 15, 7, 0, 16, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 1, 0, 15, 76, 105, 110, 101, 78, 117, 109, 98, 101, 114, 84, 97, 98, 108, 101, 1, 0, 5, 70, 105, 114, 115, 116, 1, 0, 20, 40, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 10, 83, 111, 117, 114, 99, 101, 70, 105, 108, 101, 1, 0, 19, 95, 48, 49, 95, 70, 105, 114, 115, 116, 67, 108, 97, 115, 115, 46, 106, 97, 118, 97, 12, 0, 5, 0, 6, 1, 0, 5, 102, 105, 114, 115, 116, 1, 0, 46, 99, 111, 109, 47, 116, 120, 102, 47, 99, 108, 97, 115, 115, 108, 111, 97, 100, 101, 114, 47, 67, 108, 97, 115, 115, 76, 111, 97, 100, 101, 114, 47, 95, 48, 49, 95, 70, 105, 114, 115, 116, 67, 108, 97, 115, 115, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 0, 33, 0, 3, 0, 4, 0, 0, 0, 0, 0, 2, 0, 1, 0, 5, 0, 6, 0, 1, 0, 7, 0, 0, 0, 29, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 1, -79, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 5, 0, 1, 0, 9, 0, 10, 0, 1, 0, 7, 0, 0, 0, 27, 0, 1, 0, 1, 0, 0, 0, 3, 18, 2, -80, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 7, 0, 1, 0, 11, 0, 0, 0, 2, 0, 12
```

### 自定义类加载（显式类加载）
```
public class _04_ClassLoader extends ClassLoader{
  private static String testClassName = "";

  private static byte[] testClassBytes = new byte[]{
      -54, -2, -70, -66, 0, 0, 0, 52, 0, 17, 10, 0, 4, 0, 13, 8, 0, 14, 7, 0, 15, 7, 0, 16, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 1, 0, 15, 76, 105, 110, 101, 78, 117, 109, 98, 101, 114, 84, 97, 98, 108, 101, 1, 0, 5, 70, 105, 114, 115, 116, 1, 0, 20, 40, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 10, 83, 111, 117, 114, 99, 101, 70, 105, 108, 101, 1, 0, 19, 95, 48, 49, 95, 70, 105, 114, 115, 116, 67, 108, 97, 115, 115, 46, 106, 97, 118, 97, 12, 0, 5, 0, 6, 1, 0, 5, 102, 105, 114, 115, 116, 1, 0, 46, 99, 111, 109, 47, 116, 120, 102, 47, 99, 108, 97, 115, 115, 108, 111, 97, 100, 101, 114, 47, 67, 108, 97, 115, 115, 76, 111, 97, 100, 101, 114, 47, 95, 48, 49, 95, 70, 105, 114, 115, 116, 67, 108, 97, 115, 115, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 0, 33, 0, 3, 0, 4, 0, 0, 0, 0, 0, 2, 0, 1, 0, 5, 0, 6, 0, 1, 0, 7, 0, 0, 0, 29, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 1, -79, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 5, 0, 1, 0, 9, 0, 10, 0, 1, 0, 7, 0, 0, 0, 27, 0, 1, 0, 1, 0, 0, 0, 3, 18, 2, -80, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 7, 0, 1, 0, 11, 0, 0, 0, 2, 0, 12
};

  @Override
  public Class<?> findClass(String name) throws ClassNotFoundException {
      return defineClass(testClassBytes, 0, testClassBytes.length);
  }

  public static void main(String[] args) {

    _04_ClassLoader loader = new _04_ClassLoader();

    try {
      // 使用自定义的类加载器加载类,基于双亲委派原则，因为前面testClassName是空或者可以理解为不存在，所以会用到前面重写的findClass来加载testClassBytes
      Class testClass = loader.loadClass(testClassName);

      // 反射创建类
      Object testInstance = testClass.newInstance();

      // 反射获取方法
      Method method = testInstance.getClass().getMethod("First");

      // 反射调用方法
      String str = (String) method.invoke(testInstance);

      System.out.println(str);
    } catch (Exception e) {
      e.printStackTrace();
    }
  }
}
```
result：
```
first
```